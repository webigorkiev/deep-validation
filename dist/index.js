(()=>{"use strict";var l={};(()=>{l.n=s=>{var a=s&&s.__esModule?()=>s.default:()=>s;return l.d(a,{a}),a}})(),(()=>{l.d=(s,a)=>{for(var e in a)l.o(a,e)&&!l.o(s,e)&&Object.defineProperty(s,e,{enumerable:!0,get:a[e]})}})(),(()=>{l.o=(s,a)=>Object.prototype.hasOwnProperty.call(s,a)})(),(()=>{l.r=s=>{typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})}})();var b={};l.r(b),l.d(b,{Validation:()=>T,array:()=>j,boolean:()=>A,dateISO:()=>F,default:()=>H,depends:()=>B,digits:()=>R,email:()=>k,equalTo:()=>V,max:()=>$,maxlength:()=>z,min:()=>L,minlength:()=>q,number:()=>S,object:()=>P,range:()=>I,rangedate:()=>G,rangelength:()=>D,regexp:()=>W,required:()=>C,uaPhone:()=>Z,url:()=>N});const E=require("@jwn-js/easy-ash/isObject");var p=l.n(E);const x=require("@jwn-js/common/ApiError");var r=l.n(x),_=(s,a,e)=>{if(!a.has(s))throw TypeError("Cannot "+e)},h=(s,a,e)=>(_(s,a,"read from private field"),e?e.call(s):a.get(s)),u=(s,a,e)=>{if(a.has(s))throw TypeError("Cannot add the same private member more than once");a instanceof WeakSet?a.add(s):a.set(s,e)},g=(s,a,e,t)=>(_(s,a,"write to private field"),t?t.call(s,e):a.set(s,e),e),f,d,y,M,m,w;const O={isFieldNameMode:!0,defaultCode:400},i={required:"the value is empty",boolean:"the value not boolean value",array:"the value not array value",object:"the value not object value",minlength:"the number of characters in the line is less !%",maxlength:"the number of characters in the line is more !%",rangelength:"the number of characters in a line outside the range from !% to !% \u0441\u0438\u043C\u0432\u043E\u043B\u043E\u0432",range:"the value is not in the range from !% to !%",min:"the value less than minimum value !%",max:"the value is greater than the maximum value !%",email:"the email address is not correct",url:"the url is not correct",dateISO:"the ISO date format is not correct",digits:"the value is not an integer",number:"the value is not a decimal number",equalTo:"field values are not equivalent",regexp:"the field value does not match the pattern",phone:"the phone number is not correct",depends:"the custom handler error",rangedate:"the date out of range !% - !%"},C={param:!0},A={param:!0},S={param:!0},j={param:!0},P={param:!0},q={param:0},z={param:65535},D={param:[0,255]},I={param:[0,65535]},L={param:0},$={param:65535},k={param:!0},N={param:!0},F={param:!0},R={param:!0},V={param:!0},W={param:/\d/i},Z={param:!0},B={param:(s,a)=>!0},G={param:[new Date,new Date]};class T{constructor(a={},e={}){u(this,f,void 0),u(this,d,void 0),u(this,y,void 0),u(this,M,void 0),u(this,m,void 0),u(this,w,void 0);const t=Object.assign({},O,e);g(this,m,a),g(this,f,t.isFieldNameMode),g(this,d,t.defaultStatusCode)}setModel(a={}){g(this,m,a)}validate(a,e=[]){const t=this.cutTwolastLevel(h(this,m));if(!t)throw new(r())({message:"invalid validation model",code:1,statusCode:h(this,d)});return this.validateRecurcive(t,a,e)}validateRecurcive(a,e,t=[],n=[]){for(const o in a){if(!this.isKeyDeepInFilters([...n,o],t)&&t.length)continue;const c=e[o]??void 0;p()(a[o])?this.validateRecurcive(a[o],c,t,[...n,o]):this.validateParam([...n,o],c,t)}return!0}cutTwolastLevel(a){return this.lastLevelCut(this.lastLevelCut(a))}lastLevelCut(a,e={}){if(!!a){for(const t in a)if(a.hasOwnProperty(t)){const n=a[t];if(p()(n))e[t]=this.lastLevelCut(n);else return}return e}}validateParam(a,e,t){g(this,w,a.join("."));const n=this.getDeepValidators(a);for(const o in n){if(!n.hasOwnProperty(o)||typeof this[o]!="function")throw new(r())({message:`Row ${a.join(".")}: validator ${o} not implemented`,code:2,statusCode:h(this,d)});const c=n[o];(e!==""&&e!==void 0&&e!==null&&!Number.isNaN(e)||o==="required")&&this[o](e,c)}}getDeepValidators(a){return a.reduce((e,t)=>{if(!e.hasOwnProperty(t))throw new(r())({message:`There no validators for ${a.join(".")}`,code:1,statusCode:h(this,d)});return e[t]},h(this,m))}isKeyDeepInFilters(a,e,t=0){const n=a[t];if(!n)return!1;let o=e.includes(n);const c=e.filter(v=>p()(v));for(const v of c)v.hasOwnProperty(n)&&(t<a.length-1?o=this.isKeyDeepInFilters(a,v[n],++t):o=!0);return o}getValidatedParams(){return h(this,M)}getInputParams(){return h(this,y)}adaptToErrorMessage(a,e,t,n=[]){const o=Object.assign({message:e,code:t,statusCode:h(this,d)},a);return o.message=this.messageReplace(o.message,n),o}valueLength(a){let e;if(typeof a=="string"||Array.isArray(a))e=a.length;else if(a instanceof Set||a instanceof Map)e=a.size;else throw new(r())({message:"the value has no length",code:3,statusCode:h(this,d)});return e}required(a,e){if(typeof a=="undefined"||Number.isNaN(a))throw new(r())(this.adaptToErrorMessage(e,i.required,4))}boolean(a,e){if(typeof a!="boolean")throw new(r())(this.adaptToErrorMessage(e,i.boolean,5))}array(a,e){if(!Array.isArray(a))throw new(r())(this.adaptToErrorMessage(e,i.array,5))}object(a,e){if(!p()(a))throw new(r())(this.adaptToErrorMessage(e,i.object,5))}minlength(a,e){if(this.valueLength(a)<e.param)throw new(r())(this.adaptToErrorMessage(e,i.minlength,6,[e.param]))}maxlength(a,e){if(this.valueLength(a)>e.param)throw new(r())(this.adaptToErrorMessage(e,i.maxlength,7,[e.param]))}rangelength(a,e){if(!Array.isArray(e.param))throw new(r())({message:"options for rangelength should be an array",code:8,statusCode:h(this,d)});const t=this.valueLength(a);if(t<e.param[0]||t>e.param[1])throw new(r())(this.adaptToErrorMessage(e,i.rangelength,9,[...e.param]))}min(a,e){if(typeof e.param!="number")throw new(r())({message:"options for min should be should be a number",code:10,statusCode:h(this,d)});if(a<e.param)throw new(r())(this.adaptToErrorMessage(e,i.min,11,[String(e.param)]))}max(a,e){if(typeof e.param!="number")throw new(r())({message:"options for max should be should be a number",code:12,statusCode:h(this,d)});if(a>e.param)throw new(r())(this.adaptToErrorMessage(e,i.max,13,[String(e.param)]))}range(a,e){if(!Array.isArray(e.param))throw new(r())({message:"options for range should be should be an array",code:12,statusCode:h(this,d)});if(a<e.param[0]||a>e.param[1])throw new(r())(this.adaptToErrorMessage(e,i.range,15,[...e.param]))}email(a,e){if(!/^[a-zA-Z0-9.!#$%&\'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/i.test(a))throw new(r())(this.adaptToErrorMessage(e,i.email,16))}url(a,e){if(!/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9]-*)*[a-z0-9]+)(?:\.(?:[a-z0-9]-*)*[a-z0-9]+)*(?:\.(?:[a-z]{2,})).?)(?::\d{2,5})?(?:[\/?#]\S*)?$/i.test(a))throw new(r())(this.adaptToErrorMessage(e,i.url,17))}dateISO(a,e){if(!/^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])$/i.test(a))throw new(r())(this.adaptToErrorMessage(e,i.dateISO,18))}digits(a,e){if(typeof a!="number"||a!==Math.round(a))throw new(r())(this.adaptToErrorMessage(e,i.digits,19))}number(a,e){if(typeof a!="number")throw new(r())(this.adaptToErrorMessage(e,i.number,20))}equalTo(a,e){if(a!==e.param)throw new(r())(this.adaptToErrorMessage(e,i.equalTo,21))}regexp(a,e){if(!(e.param instanceof RegExp))throw new(r())({message:"options for regexp should be should be a regex",code:22,statusCode:h(this,d)});if(!e.param.test(a))throw new(r())(this.adaptToErrorMessage(e,i.regexp,22))}uaPhone(a,e){if(!/^\+380[5-9]{1}[0-9]{1}[0-9]{3}[0-9]{2}[0-9]{2}$/i.test(a))throw new(r())(this.adaptToErrorMessage(e,i.phone,23))}rangedate(a,e){if(!Array.isArray(e.param))throw new(r())({message:"options for rangedate should be should be an array",code:24,statusCode:h(this,d)});const t=new Date(a);let n=!0;if(e.param[0]&&t<new Date(e.param[0])&&(n=!1),e.param[0]&&t>new Date(e.param[1])&&(n=!1),!n)throw new(r())(this.adaptToErrorMessage(e,i.rangedate,25,[...e.param]))}depends(a,e){if(typeof e.param!="function")throw new(r())({message:"options depends should be should be a function",code:24,statusCode:h(this,d)});if(!e.param(a,e))throw new(r())(this.adaptToErrorMessage(e,i.depends,25))}messageReplace(a,e=[]){return e.map(t=>a=a.replace("!%",t)),h(this,f)?`${h(this,w)}: ${a}`:a}}f=new WeakMap,d=new WeakMap,y=new WeakMap,M=new WeakMap,m=new WeakMap,w=new WeakMap;const H=T;module.exports=b})();
